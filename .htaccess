# ----------------------------------------------------------------------
# UTF-8 encoding
# ----------------------------------------------------------------------

    # Use UTF-8 encoding for anything served text/plain or text/html
    AddDefaultCharset utf-8

    # Force UTF-8 for a number of file formats
    AddCharset utf-8 .html .css .js .xml .json .rss .atom




# ----------------------------------------------------------------------
# Gzip compression
# ----------------------------------------------------------------------

    <IfModule mod_deflate.c>

        # Force deflate for mangled headers developer.yahoo.com/blogs/ydn/posts/2010/12/pushing-beyond-gzipping/
        <IfModule mod_setenvif.c>
            <IfModule mod_headers.c>
                SetEnvIfNoCase ^(Accept-EncodXng|X-cept-Encoding|X{15}|~{15}|-{15})$ ^((gzip|deflate)\s*,?\s*)+|[X~-]{4,13}$ HAVE_Accept-Encoding
                RequestHeader append Accept-Encoding "gzip,deflate" env=HAVE_Accept-Encoding
            </IfModule>
        </IfModule>

        # Compress all output labeled with one of the following MIME-types
        # (for Apache versions below 2.3.7, you don't need to enable `mod_filter`
        # and can remove the `<IfModule mod_filter.c>` and `</IfModule>` lines as
        # `AddOutputFilterByType` is still in the core directives)
        AddOutputFilterByType DEFLATE application/atom+xml \
                                      application/javascript \
                                      application/json \
                                      application/rss+xml \
                                      application/vnd.ms-fontobject \
                                      application/x-font-ttf \
                                      application/xhtml+xml \
                                      application/xml \
                                      font/opentype \
                                      image/svg+xml \
                                      image/x-icon \
                                      text/css \
                                      text/html \
                                      text/plain \
                                      text/x-component \
                                      text/xml

    </IfModule>




# ----------------------------------------------------------------------
# Expires headers (for better cache control)
# ----------------------------------------------------------------------

    # These are pretty far-future expires headers.
    # They assume you control versioning with filename-based cache busting
    # Additionally, consider that outdated proxies may miscache
    # www.stevesouders.com/blog/2008/08/23/revving-filenames-dont-use-querystring/

    # If you don't use filenames to version, lower the CSS and JS to something like
    # "access plus 1 week".

    <IfModule mod_expires.c>
        ExpiresActive on

        # Perhaps better to whitelist expires rules? Perhaps.
        ExpiresDefault                          "access plus 1 month"

        # cache.appcache needs re-requests in FF 3.6 (thanks Remy ~Introducing HTML5)
        ExpiresByType text/cache-manifest       "access plus 0 seconds"

        # Your document html
        ExpiresByType text/html                 "access plus 0 seconds"

        # Data
        ExpiresByType application/json          "access plus 0 seconds"
        ExpiresByType application/xml           "access plus 0 seconds"
        ExpiresByType text/xml                  "access plus 0 seconds"

        # Feed
        ExpiresByType application/atom+xml      "access plus 1 hour"
        ExpiresByType application/rss+xml       "access plus 1 hour"

        # Favicon (cannot be renamed)
        ExpiresByType image/x-icon              "access plus 1 week"

        # Media: images, video, audio
        ExpiresByType audio/ogg                 "access plus 1 month"
        ExpiresByType image/gif                 "access plus 1 month"
        ExpiresByType image/jpeg                "access plus 1 month"
        ExpiresByType image/png                 "access plus 1 month"
        ExpiresByType video/mp4                 "access plus 1 month"
        ExpiresByType video/ogg                 "access plus 1 month"
        ExpiresByType video/webm                "access plus 1 month"

        # HTC files  (css3pie)
        ExpiresByType text/x-component          "access plus 1 month"

        # Webfonts
        ExpiresByType application/vnd.ms-fontobject "access plus 1 month"
        ExpiresByType application/x-font-ttf    "access plus 1 month"
        ExpiresByType application/x-font-woff   "access plus 1 month"
        ExpiresByType font/opentype             "access plus 1 month"
        ExpiresByType image/svg+xml             "access plus 1 month"

        # CSS and JavaScript
        ExpiresByType application/javascript    "access plus 1 year"
        ExpiresByType text/css                  "access plus 1 year"

    </IfModule>




# ----------------------------------------------------------------------
# Start rewrite engine
# ----------------------------------------------------------------------

    <IfModule mod_rewrite.c>
        RewriteEngine on
        RewriteBase /

        # block text files in the content folder from being accessed directly
        RewriteRule ^content/(.*)\.(txt|md|mdown)$ index.php [L]

        # block all files in the site folder from being accessed directly
        RewriteRule ^site/(.*) index.php [L]

        # block all files in the kirby folder from being accessed directly
        RewriteRule ^kirby/(.*) index.php [L]

        # make site links work
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule ^(.*) index.php [L]




# ----------------------------------------------------------------------
# Redirect ALL the things to .com
# ----------------------------------------------------------------------

    # .me domain
    RewriteCond %{HTTP_HOST} ^(www\.)?bramsmulders\.me$ [NC]
    RewriteRule ^(.*)$ http://bramsmulders.com/$1 [R=301,L]

    # .be domain
    RewriteCond %{HTTP_HOST} ^(www\.)?bramsmulders\.be$ [NC]
    RewriteRule ^(.*)$ http://bramsmulders.com/$1 [R=301,L]


    # URL migration
    # ----------------------------------------------------------------------

        Redirect 301 /finger-friendly-all-the-things.html http://bramsmulders.com/blog/finger-friendly-all-the-things
        Redirect 301 /how-i-improved-my-workflow-with-smacss-sass.html http://bramsmulders.com/blog/how-i-improved-my-workflow-with-smacss-sass
        Redirect 301 /i-am-fine-just-an-introvert.html http://bramsmulders.com/blog/i-am-fine-just-an-introvert




# ----------------------------------------------------------------------
# Suppress or force the "www." at the beginning of URLs
# ----------------------------------------------------------------------

        # Option 1:
        # Rewrite "www.example.com -> example.com"

        RewriteCond %{HTTPS} !=on
        RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
        RewriteRule ^ http://%1%{REQUEST_URI} [R=301,L]

    </IfModule>
